<?xml version="1.0" encoding="UTF-8"?>
<!-- Set some basic project information and targets -->
<project name="My ZF Project" default="build">
 
<target name="build"
depends="prepare, lint, phpcs"/>
<target name="build-parallel"
depends="prepare,lint, tools-parallel"/>
 
<property environment="env"/>
 
<target name="tools-parallel" description="Run tools in parallel">
<parallel threadCount="2">
<antcall target="phpcs"/>
</parallel>
</target>
<!-- Clean up from previous builds -->
<target name="clean" description="Cleanup build artifacts">
<delete dir="${basedir}/build/coverage"/>
<delete dir="${basedir}/build/logs"/>
<delete dir="${basedir}/build/api"/>
<delete dir="${basedir}/application/cache"/>
</target>
 
<!-- Prepare for the new build -->
<target name="prepare" depends="clean" description="Prepare for build">
<mkdir dir="${basedir}/build/coverage"/>
<mkdir dir="${basedir}/build/logs"/>
<mkdir dir="${basedir}/build/api"/>
<mkdir dir="${basedir}/application/cache"/>
</target>
 
<!-- Lint the PHP files in application dir. Linting the whole ZF framework library takes forever -->
<target name="lint" description="Perform syntax check of sourcecode files">
<apply executable="php" failonerror="true">
<arg value="-l" />
<fileset dir="${basedir}/">
<include name="**/*.php" />
<modified />
</fileset>
</apply>
</target>
 
<!-- PHP Code Sniffer - tokenises PHP, JS and CSS files and detects violations of defined coding standards -->
<target name="phpcs" description="Check code with PHP Code Sniffer">
<exec executable="phpcs">
<arg value="-n" />
<arg path="${basedir}/" />
</exec>
</target>
</project>


